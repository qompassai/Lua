# 11-alsa.conf
# Qompass AI WirePlumber Alsa Config
# Copyright (C) 2026 Qompass AI, All rights reserved
# ----------------------------------------
wireplumber.components = [
  {
    type     = virtual
    provides = monitor.alsa-midi.monitoring
    requires = [ api.file-monitor ]
  }
  {
    type     = virtual
    provides = monitor.alsa.reserve-device
    requires = [ support.reserve-device ]
  }
  {
    name     = monitors/alsa.lua
    type     = script/lua
    provides = monitor.alsa
    requires = [ support.export-core, pw.client-device ]
    wants    = [ monitor.alsa.reserve-device ]
  }
  {
    name     = monitors/alsa-midi.lua
    type     = script/lua
    provides = monitor.alsa-midi
    wants    = [ monitor.alsa-midi.monitoring ]
  }
  {
    name     = monitors/v4l2/create-device.lua
    type     = script/lua
    provides = hooks.monitor.v4l2-create-device
    requires = [
      pw.client-device,
      support.export-core,
      support.standard-event-source
    ]
  }
  {
    name     = monitors/v4l2/create-node.lua
    type     = script/lua
    provides = hooks.monitor.v4l2-create-node
  }
  {
    name     = monitors/v4l2/enumerate-device.lua
    type     = script/lua
    provides = monitor.v4l2
    requires = [
      hooks.monitor.v4l2-create-device,
      hooks.monitor.v4l2-create-node,
      pw.client-device,
      support.export-core,
      support.standard-event-source
    ]
    wants    = [
      hooks.monitor.v4l2-name-device,
      hooks.monitor.v4l2-name-node
    ]
  }
  {
    name     = monitors/v4l2/name-device.lua
    type     = script/lua
    provides = hooks.monitor.v4l2-name-device
  }
  {
    name     = monitors/v4l2/name-node.lua
    type     = script/lua
    provides = hooks.monitor.v4l2-name-node
  }
]
wireplumber.settings = {
}
monitor.alsa-midi.properties = {
  api.alsa.disable-longname = false
  node.name                 = "Midi-Bridge"
}
monitor.alsa.properties = {
}
monitor.alsa.rules = [
  {
    matches = [
      { device.name = "~alsa_card.*" }
    ]
    actions = {
      update-props = {
        api.alsa.ignore-dB  = false
        api.alsa.soft-mixer = false
        api.alsa.use-acp    = true
        api.alsa.use-ucm    = false
        device.disabled     = false
        # device.nick        = "My Device"
        # device.profile     = "default profile name"
        # device.profile-set = "profileset-name"
      }
    }
  }
  {
    matches = [
      { node.name = "~alsa_input.*" }
      { node.name = "~alsa_output.*" }
    ]
    actions = {
      update-props = {
        api.alsa.disable-batch          = false
        api.alsa.disable-mmap           = false
        api.alsa.headroom               = 512
        api.alsa.multirate              = true
        api.alsa.period-num             = 2
        api.alsa.period-size            = 1024
        api.alsa.start-delay            = 0
        api.alsa.use-chmap              = false
        audio.allowed-rates             = [ 32000, 44100, 48000, 96000 ]
        audio.channels                  = 2
        audio.format                    = "S16LE"
        audio.position                  = [ FL, FR ]
        audio.rate                      = 48000
        channelmix.disable              = false
        channelmix.fc-cutoff            = 12000
        channelmix.hilbert-taps         = 0
        channelmix.lfe-cutoff           = 150
        channelmix.mix-lfe              = false
        channelmix.normalize            = false
        channelmix.rear-delay           = 12.0
        channelmix.stereo-widen         = 0.0
        channelmix.upmix                = true
        channelmix.upmix-method         = "psd"
        clock.name                      = "api.alsa.0"
        dither.method                   = "none"
        dither.noise                    = 0
        latency.internal.ns             = 0
        latency.internal.rate           = 0
        monitor.channel-volumes         = false
        node.description                = "My Node Description"
        node.disabled                   = false
        node.nick                       = "My Node"
        node.pause-on-idle              = false
        priority.driver                 = 100
        priority.session                = 100
        resample.disable                = false
        resample.quality                = 4
        session.suspend-timeout-seconds = 5
      }
    }
  }
  {
    matches = [
      {
        cpu.vm.name = "~.*"
        node.name   = "~alsa_input.pci.*"
      }
      {
        cpu.vm.name = "~.*"
        node.name   = "~alsa_output.pci.*"
      }
    ]
    actions = {
      update-props = {
        api.alsa.headroom    = 2048
        api.alsa.period-size = 1024
      }
    }
  }
  {
    matches = [
      {
        cpu.vm.name = "~^(vmware)|(oracle)$"
        node.name   = "~alsa_input.pci.*"
      }
      {
        cpu.vm.name = "~^(vmware)|(oracle)$"
        node.name   = "~alsa_output.pci.*"
      }
    ]
    actions = {
      update-props = {
        api.alsa.headroom    = 8192
        api.alsa.period-size = 1024
      }
    }
  }
  {
    matches = [
      { node.name = "audiorelay-virtual-mic-sink" }
    ]
    actions = {
      update-props = {
        "media.role"       = "communication"
        "node.description" = "AudioRelay Virtual Mic"
        "priority.driver"  = 2000
        "priority.session" = 2000
      }
    }
  }
]
